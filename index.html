<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script>
        var url_base = "https://externalassets.herokuapp.com/v1/external_assets";

        //---------------------------- Buscar customizações
        function getCustomers(callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4) {
                    if (xmlHttp.status == 200) {
                        callback(xmlHttp.responseText);
                    } else if (xmlHttp.status == 500) {
                        alert("Erro Response: " + xmlHttp.responseText);
                    }
                }
            }

            let url = url_base + "/costumer";
            xmlHttp.open('GET', url, true); // true for asynchronous 
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin', url);
            xmlHttp.setRequestHeader('Content-Type', 'application/json');
            xmlHttp.send();
        }

        function responseGetCustomers(response) {
            var res = JSON.parse(response)
            var sites = res.data;
            var html = "";
            sites.forEach(function (site, index) {
                html +=
                    `
                <div class="card">
                    <div class="card-header" id="heading-${site.id}"
                        onclick="$('#collapse-${site.id}').toggle()">
                        <h5 class="mb-0">
                            <button class="btn btn-link collapsed" type="button">
                                <div class="form-group">
                                    <input class="form-control form-control-sm input-${site.id}" id="site-${site.id}-input-name" name="name" value="${site.name}" type="text" placeholder="${site.name}">
                                </div>
                            </button>
                        </h5>
                    </div>
                    <div id="collapse-${site.id}" style="display:none">
                        <div class="card-body">
                `;


                Object.entries(site).forEach(([idCampo, valorCampo]) => {
                    if (idCampo != "id" && idCampo != "name") {
                        html +=
                            `
                        <div class="form-group">
                            <label for="input-${idCampo}">${idCampo}</label>
                            <input class="form-control form-control-sm input-${site.id}" id="site-${site.id}-input-${idCampo}" name="${idCampo}" value="${valorCampo}" type="text" placeholder="${valorCampo}">
                        </div>
                    `;
                    }
                });


                html +=
                    `
                        <div class="form-group">
                            <button type="button" onclick="save(${site.id})" class="btn btn-primary">Salvar</button>
                        </div>
                        </div>
                    </div >
                </div >
                `;

            });
            $("#accord").html(html);


        }

        function triggerGetCustomers() {
            getCustomers(responseGetCustomers);
        }

        //---------------------------- Buscar customizações expecifica
        function getCustomer(callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4) {
                    if (xmlHttp.status == 200) {
                        callback(xmlHttp.responseText);
                    } else if (xmlHttp.status == 500) {
                        alert("Erro Response: " + xmlHttp.responseText);
                    }
                }
            }
            let customerId = "1";
            let url = url_base + "/costumer_id/" + customerId;
            xmlHttp.open('GET', url, true); // true for asynchronous 
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin', url);
            xmlHttp.setRequestHeader('Content-Type', 'application/json');
            xmlHttp.send();
        }

        function responseGetCustomer(response) {
            console.log("responseGetCustomer ", response);
        }

        function triggerGetCustomer() {
            getCustomer(responseGetCustomer);
        }

        //---------------------------- Criar customizações
        function createCustomers(callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4) {
                    if (xmlHttp.status == 200) {
                        callback(xmlHttp.responseText);
                    } else {
                        console.log("Erro Response: ", xmlHttp.responseText);
                        alert("Erro Response: " + xmlHttp.responseText);
                    }
                }
            }

            let url = url_base + "/costumer";
            xmlHttp.open('POST', url, true); // true for asynchronous 
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin', url);
            xmlHttp.setRequestHeader('Content-Type', 'application/json');
            xmlHttp.send(JSON.stringify({
                "name": "occ1",
                "descricao": "desc1",
                "site_logo_1": "logo1",
                "site_logo_2": "logo2"
            }));
        }

        function responseCreateCustomers(response) {
            console.log("responseCreateCustomers ", response);
        }

        function triggerCreateCustomers() {
            createCustomers(responseCreateCustomers);
        }

        //---------------------------- Atualizar customizações
        function updateCustomers(callback,body) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4) {
                    if (xmlHttp.status == 200) {
                        callback(xmlHttp.responseText);
                    } else {
                        console.log("Erro Response: ", xmlHttp.responseText);
                        alert("Erro Response: " + xmlHttp.responseText);
                    }
                }
            }

            let url = url_base + "/costumer";
            xmlHttp.open('PUT', url, true); // true for asynchronous 
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin', url);
            xmlHttp.setRequestHeader('Content-Type', 'application/json');
            xmlHttp.send(JSON.stringify(body));
        }

        function responseUpdateCustomers(response) {
            console.log("responseUpdateCustomers ", response);
        }

        function triggerUpdateCustomers(body) {
            updateCustomers(responseUpdateCustomers,body);
        }

        //---------------------------- Remover customizações
        function removeCustomers(callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function () {
                if (xmlHttp.readyState == 4) {
                    if (xmlHttp.status == 200) {
                        callback(xmlHttp.responseText);
                    } else {
                        console.log("Erro Response: ", xmlHttp.responseText);
                        alert("Erro Response: " + xmlHttp.responseText);
                    }
                }
            }

            let url = url_base + "/costumer";
            xmlHttp.open('DELETE', url, true); // true for asynchronous 
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin', url);
            xmlHttp.setRequestHeader('Content-Type', 'application/json');
            xmlHttp.send(JSON.stringify({
                "id": "2"
            }));
        }

        function responseRemoveCustomers(response) {
            console.log("responseRemoveCustomers ", response);
            alert("responseRemoveCustomers : " + response);
        }

        function triggerRemoveCustomers() {
            removeCustomers(responseRemoveCustomers);
        }

    </script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
</head>

<body>

    <script>

        function save(id) {

            var site = { id: id }

            $(".input-" + id).each(function (index) {
                site[$(this).attr("name")] = $(this).val()
            });

            triggerUpdateCustomers(site)

        }

        $("document").ready(function () {
            triggerGetCustomers()
        })

    </script>

    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="accord" id="accord">
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12">
                <button type="button" class="btn btn-outline-primary" onclick="triggerGetCustomer()">Get
                    Customer</button>
                <button type="button" class="btn btn-outline-primary" onclick="triggerGetCustomers()">Get
                    Customers</button>
                <button type="button" class="btn btn-outline-primary" onclick="triggerCreateCustomers()">Create
                    Customers</button>
                <button type="button" class="btn btn-outline-primary" onclick="triggerUpdateCustomers()">Update
                    Customers</button>
                <button type="button" class="btn btn-outline-primary" onclick="triggerRemoveCustomers()">Remove
                    Customers</button>
            </div>
        </div>
    </div>
    </div>
</body>

</html>